<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Видео на фоне</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { 
            width: 100%; 
            height: 100%; 
            overflow: hidden; 
            background: #000;
            position: fixed;
        }
        
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        video {
            display: none;
        }
        
        #tap-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            font-family: Arial, sans-serif;
        }
        
        #tap-overlay.hidden { display: none; }
        
        .tap-message {
            color: #fff;
            font-size: 24px;
            padding: 30px 40px;
            background: rgba(0, 255, 0, 0.2);
            border: 3px solid #00ff00;
            border-radius: 15px;
        }
        
        .tap-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <video 
        id="bg-video"
        muted
        playsinline
        webkit-playsinline
        loop
        preload="auto"
    >
        <source src="background.mp4" type="video/mp4">
    </video>
    
    <div id="tap-overlay">
        <div class="tap-icon">▶️</div>
        <div class="tap-message">Нажмите для запуска</div>
    </div>

    <script>
        const video = document.getElementById('bg-video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('tap-overlay');
        
        let isPlaying = false;
        
        // Устанавливаем размер canvas
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // Отрисовка видео на canvas
        function drawVideo() {
            if (!isPlaying) return;
            
            // Вычисляем размеры для cover
            const videoRatio = video.videoWidth / video.videoHeight;
            const canvasRatio = canvas.width / canvas.height;
            
            let drawWidth, drawHeight, offsetX, offsetY;
            
            if (canvasRatio > videoRatio) {
                drawWidth = canvas.width;
                drawHeight = canvas.width / videoRatio;
                offsetX = 0;
                offsetY = (canvas.height - drawHeight) / 2;
            } else {
                drawWidth = canvas.height * videoRatio;
                drawHeight = canvas.height;
                offsetX = (canvas.width - drawWidth) / 2;
                offsetY = 0;
            }
            
            ctx.drawImage(video, offsetX, offsetY, drawWidth, drawHeight);
            
            requestAnimationFrame(drawVideo);
        }
        
        function startVideo() {
            if (isPlaying) return;
            
            video.muted = true;
            video.volume = 0;
            
            video.play()
                .then(() => {
                    console.log('✅ Видео запущено');
                    isPlaying = true;
                    overlay.classList.add('hidden');
                    drawVideo();
                })
                .catch(err => {
                    console.error('❌ Ошибка:', err);
                });
        }
        
        overlay.addEventListener('touchend', startVideo);
        overlay.addEventListener('click', startVideo);
        
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && isPlaying) {
                video.play();
                drawVideo();
            }
        });
        
        video.load();
    </script>
</body>
</html>
