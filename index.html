<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–í–∏–¥–µ–æ –Ω–∞ —Ñ–æ–Ω–µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            position: fixed;
        }
        
        #video-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
        }
        
        video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translate(-50%, -50%);
            object-fit: cover;
        }
        
        #tap-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            font-family: Arial, sans-serif;
        }
        
        #tap-overlay.hidden {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        
        .tap-message {
            color: #fff;
            font-size: 24px;
            padding: 30px 40px;
            background: rgba(0, 255, 0, 0.2);
            border: 3px solid #00ff00;
            border-radius: 15px;
            user-select: none;
        }
        
        .tap-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="tap-overlay">
        <div class="tap-icon">‚ñ∂Ô∏è</div>
        <div class="tap-message">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞</div>
    </div>

    <div id="video-container">
        <video 
            id="bg-video"
            muted
            playsinline
            webkit-playsinline
            preload="auto"
        >
            <source src="background.mp4" type="video/mp4">
        </video>
    </div>

    <script>
        const video = document.getElementById('bg-video');
        const overlay = document.getElementById('tap-overlay');
        
        let active = false;
        let playInProgress = false;
        
        console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è');
        
        // –ö–†–ò–¢–ò–ß–ù–û: –ë–ª–æ–∫–∏—Ä—É–µ–º –í–°–ï —Å–æ–±—ã—Ç–∏—è pause
        video.addEventListener('pause', (e) => {
            e.stopImmediatePropagation();
            e.preventDefault();
            
            if (active && !document.hidden && !playInProgress) {
                console.log('üö´ Pause –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫');
                playVideo();
            }
        }, true);
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ suspend (–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏)
        video.addEventListener('suspend', (e) => {
            e.stopImmediatePropagation();
            e.preventDefault();
            console.log('üö´ Suspend –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
        }, true);
        
        // –§—É–Ω–∫—Ü–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç race condition
        function playVideo() {
            if (playInProgress) {
                console.log('‚è≥ Play —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
                return Promise.resolve();
            }
            
            playInProgress = true;
            console.log('‚ñ∂Ô∏è –ù–∞—á–∞–ª–æ play()');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            video.muted = true;
            video.volume = 0;
            video.defaultMuted = true;
            
            return video.play()
                .then(() => {
                    playInProgress = false;
                    console.log('‚úÖ Play –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ');
                    return true;
                })
                .catch(error => {
                    playInProgress = false;
                    console.error('‚ùå Play error:', error.name, '-', error.message);
                    
                    // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "interrupted", –ø—Ä–æ–±—É–µ–º –µ—â—ë —Ä–∞–∑ —á–µ—Ä–µ–∑ 100–º—Å
                    if (error.name === 'AbortError' && active) {
                        console.log('üîÑ –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 100–º—Å');
                        return new Promise(resolve => {
                            setTimeout(() => {
                                resolve(playVideo());
                            }, 100);
                        });
                    }
                    
                    return false;
                });
        }
        
        // –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏
        let checkCounter = 0;
        setInterval(() => {
            if (active && !document.hidden && video.paused && !playInProgress) {
                checkCounter++;
                console.log(`üîÑ –ò–Ω—Ç–µ—Ä–≤–∞–ª #${checkCounter}: –≤–∏–¥–µ–æ –Ω–∞ –ø–∞—É–∑–µ, –∑–∞–ø—É—Å–∫`);
                playVideo();
            }
        }, 200);
        
        // –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
        function startVideo(e) {
            if (e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            if (active) return;
            
            console.log('üëÜ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª –≤–∏–¥–µ–æ');
            active = true;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ –µ—Å–ª–∏ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
            if (video.readyState < 2) {
                console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ...');
                video.load();
            }
            
            // –î–∞—ë–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
            const startPlay = () => {
                playVideo().then(success => {
                    if (success) {
                        console.log('üéâ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–æ');
                        overlay.classList.add('hidden');
                        
                        // –£–±–∏—Ä–∞–µ–º overlay –ø–æ–ª–Ω–æ—Å—Ç—å—é —á–µ—Ä–µ–∑ 500–º—Å
                        setTimeout(() => {
                            overlay.style.display = 'none';
                        }, 500);
                    }
                });
            };
            
            if (video.readyState >= 2) {
                startPlay();
            } else {
                video.addEventListener('loadedmetadata', startPlay, { once: true });
            }
        }
        
        // –°–æ–±—ã—Ç–∏—è
        overlay.addEventListener('touchend', startVideo, { passive: false });
        overlay.addEventListener('click', startVideo);
        
        // –ó–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ
        video.addEventListener('ended', () => {
            console.log('üîö –í–∏–¥–µ–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å, –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ');
            if (active) {
                video.currentTime = 0;
                playVideo();
            }
        });
        
        // –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ
        document.addEventListener('visibilitychange', () => {
            console.log('üëÅÔ∏è –í–∏–¥–∏–º–æ—Å—Ç—å:', !document.hidden);
            if (!document.hidden && active) {
                setTimeout(() => playVideo(), 100);
            }
        });
        
        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
        video.addEventListener('playing', () => console.log('‚úÖ playing'));
        video.addEventListener('waiting', () => console.log('‚è≥ waiting'));
        video.addEventListener('canplay', () => console.log('‚úÖ canplay'));
        video.addEventListener('error', () => console.error('üí• error:', video.error));
        
        // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞
        video.load();
        
        console.log('üì± User Agent:', navigator.userAgent.substring(0, 100));
    </script>
</body>
</html>
